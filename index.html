<!DOCTYPE html>
<html lang="ms-MY">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Kemahiran Pemulihan: Masa dan Waktu (Intermediate)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { box-sizing: border-box; }
    .activity-card { min-height: 480px; } 
    .number-card { transition: all .3s ease; cursor: pointer; }
    .number-card:hover { transform: scale(1.05); }

    /* Gaya untuk Jam Analog (SVG) */
    .clock-face { stroke: #333; stroke-width: 3; fill: white; }
    
    /* =================================
      PEMBETULAN CSS DI SINI
      =================================
      - Menggantikan #hand-hour dan #hand-minute
      - dengan class .clock-hand-hour dan .clock-hand-minute
    */
    .clock-hand {
      stroke-linecap: round;
      transform-origin: 50% 50%;
      transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .clock-hand-hour {
      stroke: #3b82f6; /* Biru */
      stroke-width: 7;
    }
    .clock-hand-minute {
      stroke: #16a34a; /* Hijau */
      stroke-width: 5;
    }
    /* ===============================
       AKHIR PEMBETULAN CSS
       =============================== */

    .clock-center { fill: #333; }
    .clock-container {
      max-width: 250px;
      margin: 1rem auto;
      touch-action: none;
    }
    
    /* Animasi */
    @keyframes shake {
      0% { transform: translateX(0); } 25% { transform: translateX(-5px); }
      50% { transform: translateX(5px); } 75% { transform: translateX(-5px); }
      100% { transform: translateX(0); }
    }
    .shake { animation: shake 0.5s ease; }
    .pulse { animation: pulse 1.5s ease-in-out infinite; }
    @keyframes pulse {
      0%, 100% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.03); opacity: .95; }
    }
    
    .jadual-item { border-left: 5px solid #6d28d9; }
    .pilihan-btn:disabled { opacity: 0.3; background-color: #9ca3af; cursor: not-allowed; }
    .hold-btn:active { transform: scale(0.95); background-color: #15803d; }
  </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-purple-50 min-h-full">

  <div class="bg-yellow-100 border-b-4 border-yellow-300 p-4 shadow-sm sticky top-0 z-10">
    <div class="max-w-6xl mx-auto flex items-center justify-between">
      <div class="flex items-center gap-3">
        <span class="text-2xl">üí°</span>
        <span id="info-text" class="text-lg font-semibold text-gray-800">
          Pilih aktiviti 'intermediate' untuk menguji kemahiran masa!
        </span>
      </div>
      <button id="speak-btn"
              class="bg-yellow-300 hover:bg-yellow-400 text-yellow-800 font-bold py-2 px-4 rounded-full text-xl transition-colors duration-200"
              onclick="speakInfo()">
        üîä
      </button>
    </div>
  </div>

  <div class="max-w-6xl mx-auto p-6">
    <div class="bg-white rounded-xl shadow-lg p-6 mb-6 activity-card flex items-center justify-center">
      <div id="activity-content" class="text-center w-full">
        <div class="py-16">
          <div class="text-6xl mb-4">‚è∞</div>
          <h2 class="text-3xl font-bold text-gray-800 mb-4">
            Kemahiran Pemulihan: Masa dan Waktu (Intermediate)
          </h2>
          <p class="text-xl text-gray-600 mb-8">
            Aplikasikan kemahiran tambah dan tolak masa anda.
          </p>
          <div class="text-4xl">üëá</div>
        </div>
      </div>
    </div>

    <div class="bg-white rounded-xl shadow-lg p-6">
      <h3 class="text-2xl font-bold text-gray-800 mb-4 text-center">Pilih Aktiviti</h3>
      <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-4 mb-6">
        <button onclick="loadActivity(1)"
                class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-4 rounded-lg text-lg transition-colors duration-200">
          1. Mesin Masa
        </button>
        <button onclick="loadActivity(2)"
                class="bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-4 rounded-lg text-lg transition-colors duration-200">
          2. Kira Tempoh
        </button>
        <button onclick="loadActivity(3)"
                class="bg-purple-500 hover:bg-purple-600 text-white font-bold py-3 px-4 rounded-lg text-lg transition-colors duration-200">
          3. Jadual Harian
        </button>
        <button onclick="loadActivity(4)"
                class="bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-4 rounded-lg text-lg transition-colors duration-200">
          4. Baki Masa Rehat
        </button>
        <button onclick="loadActivity(5)"
                class="bg-orange-500 hover:bg-orange-600 text-white font-bold py-3 px-4 rounded-lg text-lg transition-colors duration-200">
          5. Lumba Minit
        </button>
      </div>

      <div class="flex justify-center gap-4">
        <button onclick="clearActivity()" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-6 rounded-lg text-lg transition-colors duration-200">
          üßπ Bersih
        </button>
        <button onclick="nextActivity()" class="bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-6 rounded-lg text-lg transition-colors duration-200">
          ‚û°Ô∏è Seterusnya
        </button>
      </div>
    </div>
  </div>

  <script>
    let currentActivity = 0;
    let ttsEnabled = false;
    let currentInfo = "Pilih aktiviti 'intermediate' untuk menguji kemahiran masa!";
    
    let clockState = { hour: 3, minute: 0, isDragging: null };
    let activityTimer = null;
    let activityState = {}; 

    /* ====== TTS ====== */
    function speak(text) {
      if (!ttsEnabled) return;
      if (!('speechSynthesis' in window)) return;
      window.speechSynthesis.cancel();
      setTimeout(() => {
        const u = new SpeechSynthesisUtterance(text);
        u.lang = 'ms-MY'; u.rate = 0.9; u.pitch = 1.05;
        const voices = window.speechSynthesis.getVoices();
        const ms = voices.find(v => v.lang === 'ms-MY' || v.lang?.startsWith('ms'));
        if (ms) u.voice = ms;
        window.speechSynthesis.speak(u);
      }, 100);
    }
    function setInfo(text) { currentInfo = text; document.getElementById('info-text').textContent = text; }
    function speakInfo() {
      if (!ttsEnabled) {
        ttsEnabled = true;
        const btn = document.getElementById('speak-btn');
        btn.classList.add('bg-green-300', 'hover:bg-green-400');
        btn.classList.remove('bg-yellow-300', 'hover:bg-yellow-400');
      }
      speak(currentInfo);
    }
    
    // =================================================================
    // FUNGSI TERAS JAM (Termasuk fungsi seret)
    // =================================================================

    function createClockSVG(container, initialHour, initialMinute, isStatic = false) {
      const clockId = `clock-${Math.random().toString(36).substr(2, 9)}`;
      container.innerHTML = `
        <svg viewBox="0 0 200 200" class="clock-container" id="${clockId}">
          <circle cx="100" cy="100" r="95" class="clock-face"/>
          ${Array.from({length: 12}).map((_, i) => {
            const angle = (i + 1) * 30 * Math.PI / 180;
            const x = 100 + Math.sin(angle) * 78; const y = 100 - Math.cos(angle) * 78;
            return `<text x="${x}" y="${y+5}" text-anchor="middle" font-size="14" font-weight="bold" fill="#444">${i + 1}</text>`;
          }).join('')}
          ${Array.from({length: 60}).map((_, i) => {
            const angle = i * 6 * Math.PI / 180;
            const x1 = 100 + Math.sin(angle) * (i % 5 === 0 ? 85 : 90);
            const y1 = 100 - Math.cos(angle) * (i % 5 === 0 ? 85 : 90);
            const x2 = 100 + Math.sin(angle) * 92; const y2 = 100 - Math.cos(angle) * 92;
            return `<line x1="${x1}" y1="${y1}" x2="${x2}" y2="${y2}" style="stroke:${i % 5 === 0 ? '#333' : '#999'}; stroke-width: ${i % 5 === 0 ? 2 : 1};" />`;
          }).join('')}
          
          <line id="hand-hour-${clockId}" x1="100" y1="100" x2="100" y2="60" class="clock-hand clock-hand-hour"/>
          <line id="hand-minute-${clockId}" x1="100" y1="100" x2="100" y2="35" class="clock-hand clock-hand-minute"/>
          <circle cx="100" cy="100" r="5" class="clock-center"/>
        </svg>
      `;
      updateClockHands(clockId, initialHour, initialMinute);
      
      if (!isStatic) {
        const clockEl = document.getElementById(clockId);
        clockEl.style.cursor = 'pointer';
        clockState = { hour: initialHour, minute: initialMinute, isDragging: null, id: clockId };
        
        clockEl.addEventListener('mousedown', startClockDrag);
        clockEl.addEventListener('touchstart', startClockDrag, { passive: false });
      }
      return clockId;
    }
    
    function updateClockHands(clockId, hour, minute) {
      const hourEl = document.getElementById(`hand-hour-${clockId}`);
      const minuteEl = document.getElementById(`hand-minute-${clockId}`);
      if (!hourEl || !minuteEl) return;
      const minuteDeg = minute * 6;
      const hourDeg = (hour % 12) * 30 + (minute * 0.5);
      hourEl.style.transform = `rotate(${hourDeg}deg)`;
      minuteEl.style.transform = `rotate(${minuteDeg}deg)`;
    }
    
    // Fungsi seret jam (untuk Aktiviti 1)
    function startClockDrag(e) {
      e.preventDefault();
      const clockEl = e.currentTarget;
      const bb = clockEl.getBoundingClientRect();
      const cx = bb.left + bb.width / 2; const cy = bb.top + bb.height / 2;
      const px = e.clientX || e.touches[0].clientX; const py = e.clientY || e.touches[0].clientY;
      const dx = px - cx; const dy = py - cy;
      const dist = Math.sqrt(dx*dx + dy*dy);
      
      if (dist < bb.width * 0.35) { clockState.isDragging = 'hour'; } 
      else if (dist < bb.width * 0.5) { clockState.isDragging = 'minute'; }
      
      if(clockState.isDragging) {
        window.addEventListener('mousemove', handleClockDrag);
        window.addEventListener('touchmove', handleClockDrag, { passive: false });
        window.addEventListener('mouseup', stopClockDrag);
        window.addEventListener('touchend', stopClockDrag);
      }
    }

    function handleClockDrag(e) {
      if (!clockState.isDragging) return;
      e.preventDefault();
      const clockEl = document.getElementById(clockState.id);
      if(!clockEl) return;
      
      const bb = clockEl.getBoundingClientRect();
      const cx = bb.width / 2; const cy = bb.height / 2;
      const px = (e.clientX || e.touches[0].clientX) - bb.left;
      const py = (e.clientY || e.touches[0].clientY) - bb.top;
      
      let angleRad = Math.atan2(py - cy, px - cx) + Math.PI / 2;
      let angleDeg = angleRad * 180 / Math.PI;
      if (angleDeg < 0) angleDeg += 360;

      if (clockState.isDragging === 'minute') {
        clockState.minute = Math.round(angleDeg / 6) % 60;
      } else {
        const hour = Math.round(angleDeg / 30) % 12;
        clockState.hour = (clockState.hour >= 12 ? 12 : 0) + hour;
      }
      
      updateClockHands(clockState.id, clockState.hour, clockState.minute);
      if (currentActivity === 1) updateMesinMasaDisplay(clockState.hour, clockState.minute);
    }
    
    function stopClockDrag(e) {
      if(clockState.isDragging) {
        clockState.isDragging = null;
        window.removeEventListener('mousemove', handleClockDrag);
        window.removeEventListener('touchmove', handleClockDrag);
        window.removeEventListener('mouseup', stopClockDrag);
        window.removeEventListener('touchend', stopClockDrag);
        const msg = `Jam ditetapkan pada pukul ${getWaktuTeks(clockState.hour, clockState.minute)}.`;
        setInfo(msg); speak(msg);
      }
    }
    
    function getWaktuTeks(h, m) {
        const jam = ["dua belas", "satu", "dua", "tiga", "empat", "lima", "enam", "tujuh", "lapan", "sembilan", "sepuluh", "sebelas", "dua belas"];
        const h_text = jam[h % 12 === 0 ? (h === 0 ? 0 : 12) : h % 12];
        if (m === 0) return `${h_text} tepat`;
        if (m === 15) return `${h_text} suku`;
        if (m === 30) return `${h_text} setengah`;
        return `${h_text} ${m.toString().padStart(2, '0')}`;
    }
    
    function formatDigital(h, m) {
      return `${(h % 12 === 0 ? 12 : h % 12).toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}`;
    }

    /* ====== Router ====== */
    function loadActivity(n) {
      currentActivity = n;
      const content = document.getElementById('activity-content');
      stopClockDrag();
      if (activityTimer) clearInterval(activityTimer);
      
      if (n === 1) return loadMesinMasa(content);
      if (n === 2) return loadKiraTempoh(content);
      if (n === 3) return loadJadualHarian(content);
      if (n === 4) return loadBakiMasa(content);
      if (n === 5) return loadLumbaMinit(content);
    }

    /* ====== Aktiviti 1: Mesin Masa ====== */
    function loadMesinMasa(content) {
      const info = "Masa mula jam 2:00. Tempoh aktiviti ialah 3 jam 15 minit. Laraskan 'Jam Tamat' ke jawapan yang betul.";
      setInfo(info);
      
      content.innerHTML = `
        <h3 class="text-2xl font-bold text-blue-600 mb-4">1. Mesin Masa</h3>
        <p class="text-lg text-gray-700 mb-4">
          Masa Mula: <strong>2:00</strong>. Tempoh: <strong>3 jam 15 minit</strong>.
        </p>
        <div class="flex flex-col md:flex-row justify-around items-center gap-4">
          <div class="text-center">
            <h4 class="text-lg font-semibold">Jam Mula (2:00)</h4>
            <div id="clock-start"></div>
          </div>
          <div class="text-center">
            <h4 class="text-lg font-semibold">Jam Tamat (Laraskan)</h4>
            <div id="clock-end"></div>
            <div id="digital-display-1" class="text-3xl font-bold text-gray-800 mt-2">03:00</div>
          </div>
        </div>
        <button id="semak-1" class="mt-6 bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-lg text-xl">
          Semak Jawapan
        </button>
      `;
      
      createClockSVG(document.getElementById('clock-start'), 2, 0, true); // Jam statik
      createClockSVG(document.getElementById('clock-end'), 3, 0, false); // Jam interaktif
      updateMesinMasaDisplay(3, 0); 
      
      document.getElementById('semak-1').onclick = () => {
        // Jawapan betul: 2:00 + 3j 15m = 5:15
        const isCorrect = (clockState.hour % 12 === 5) && (clockState.minute === 15);
        const clockEl = document.getElementById(clockState.id);
        clockEl.classList.remove('shake');
        
        if (isCorrect) {
          const msg = "Syabas! 5:15 ialah jawapan yang betul.";
          setInfo(msg); speak(msg);
          clockEl.querySelector('.clock-face').style.fill = '#dcfce7'; // hijau
        } else {
          const msg = `Hmm. ${getWaktuTeks(clockState.hour, clockState.minute)} bukan jawapannya. Cuba kira 2:00 tambah 3 jam 15 minit.`;
          setInfo(msg); speak(msg);
          clockEl.classList.add('shake');
          setTimeout(() => clockEl.classList.remove('shake'), 500);
          clockEl.querySelector('.clock-face').style.fill = '#fee2e2'; // merah
        }
      };
    }
    
    function updateMesinMasaDisplay(h, m) {
      document.getElementById('digital-display-1').textContent = formatDigital(h, m);
    }

    /* ====== Aktiviti 2: Kira Tempoh ====== */
    function loadKiraTempoh(content) {
      const info = "Kira tempoh dari 9:00 pagi hingga 1:00 petang. Guna butang '+ 1 jam' untuk mengira.";
      setInfo(info);
      activityState = { duration: 0 };
      
      content.innerHTML = `
        <h3 class="text-2xl font-bold text-green-600 mb-4">2. Kira Tempoh</h3>
        <p class="text-lg text-gray-700 mb-4">
          Dari <strong>9:00 pagi</strong> hingga <strong>1:00 petang</strong>.
        </p>
        <div class="flex flex-col md:flex-row justify-around items-center gap-4 mb-4">
          <div class="text-center">
            <h4 class="text-lg font-semibold">Masa Mula (9:00)</h4>
            <div id="clock-start-2"></div>
          </div>
          <div class="text-center">
            <h4 class="text-lg font-semibold">Masa Tamat (1:00)</h4>
            <div id="clock-end-2"></div>
          </div>
        </div>
        <div class="bg-gray-100 p-4 rounded-lg">
          <div class="text-lg font-semibold">Tempoh Masa Dikira:</div>
          <div id="tempoh-display" class="text-5xl font-bold text-green-700 my-2">0 jam</div>
          <button id="tambah-jam" class="bg-green-500 text-white font-bold py-2 px-5 rounded-lg text-lg mr-2">+ 1 jam</button>
          <button id="tolak-jam" class="bg-gray-400 text-white font-bold py-2 px-5 rounded-lg text-lg">- 1 jam</button>
        </div>
        <button id="semak-2" class="mt-6 bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-lg text-xl">
          Semak Tempoh
        </button>
      `;

      createClockSVG(document.getElementById('clock-start-2'), 9, 0, true);
      createClockSVG(document.getElementById('clock-end-2'), 13, 0, true);
      
      const display = document.getElementById('tempoh-display');
      
      document.getElementById('tambah-jam').onclick = () => {
        activityState.duration++;
        display.textContent = `${activityState.duration} jam`;
        speak(`${activityState.duration} jam`);
      };
      document.getElementById('tolak-jam').onclick = () => {
        if (activityState.duration > 0) {
          activityState.duration--;
          display.textContent = `${activityState.duration} jam`;
          speak(`${activityState.duration} jam`);
        }
      };
      
      document.getElementById('semak-2').onclick = () => {
        const displayBox = display.parentElement;
        displayBox.classList.remove('shake');
        if (activityState.duration === 4) {
          const msg = "Betul! Tempohnya ialah 4 jam.";
          setInfo(msg); speak(msg);
          displayBox.style.backgroundColor = '#dcfce7'; // hijau
        } else {
          const msg = `Bukan ${activityState.duration} jam. Cuba kira semula: 9 ke 10, 10 ke 11...`;
          setInfo(msg); speak(msg);
          displayBox.classList.add('shake');
          setTimeout(() => displayBox.classList.remove('shake'), 500);
          displayBox.style.backgroundColor = '#fee2e2'; // merah
        }
      };
    }

    /* ====== Aktiviti 3: Jadual Harian (Sandbox) ====== */
    function loadJadualHarian(content) {
      const info = "Eksplorasi: Bina jadual anda. Klik butang aktiviti untuk menambahnya ke jadual.";
      setInfo(info);
      activityState = { currentTimeMinutes: 8 * 60 }; 
      
      content.innerHTML = `
        <h3 class="text-2xl font-bold text-purple-600 mb-4">3. Jadual Harian Saya (Eksplorasi)</h3>
        <div class="flex flex-col md:flex-row gap-6">
          <div class="w-full md:w-1/3 bg-gray-50 p-4 rounded-lg">
            <h4 class="text-lg font-semibold mb-3">Pilih Aktiviti:</h4>
            <div id="bank-butang" class="flex flex-col gap-2">
              <button data-name="Matematik" data-duration="60" class="bg-purple-500 hover:bg-purple-600 text-white p-3 rounded-lg text-left">
                + Sesi Matematik (1 jam)
              </button>
              <button data-name="Rehat" data-duration="30" class="bg-purple-500 hover:bg-purple-600 text-white p-3 rounded-lg text-left">
                + Rehat (30 minit)
              </button>
              <button data-name="Sains" data-duration="90" class="bg-purple-500 hover:bg-purple-600 text-white p-3 rounded-lg text-left">
                + Sesi Sains (1 jam 30 minit)
              </button>
              <button data-name="Makan" data-duration="45" class="bg-purple-500 hover:bg-purple-600 text-white p-3 rounded-lg text-left">
                + Makan Tengah Hari (45 minit)
              </button>
            </div>
          </div>
          <div class="w-full md:w-2/3">
            <h4 class="text-lg font-semibold mb-3">Jadual Anda:</h4>
            <div id="jadual-list" class="flex flex-col gap-2">
              <div class="bg-gray-200 p-3 rounded-lg text-gray-600">
                Masa Mula: <strong>8:00 AM</strong>. Tekan butang untuk tambah aktiviti.
              </div>
            </div>
          </div>
        </div>
      `;
      
      document.getElementById('bank-butang').querySelectorAll('button').forEach(btn => {
        btn.onclick = (e) => {
          const name = e.target.dataset.name;
          const duration = parseInt(e.target.dataset.duration);
          const startTime = activityState.currentTimeMinutes;
          const endTime = startTime + duration;
          const startTimeStr = formatMinutesToAMPM(startTime);
          const endTimeStr = formatMinutesToAMPM(endTime);
          
          const newItem = document.createElement('div');
          newItem.className = 'jadual-item bg-purple-50 p-3 rounded-lg shadow-sm';
          newItem.innerHTML = `
            <strong class="text-purple-800">${name}</strong> (${duration} minit)
            <div class="text-sm text-gray-700">Masa: ${startTimeStr} ‚ûî ${endTimeStr}</div>
          `;
          
          const list = document.getElementById('jadual-list');
          if(list.children.length === 1 && list.children[0].classList.contains('bg-gray-200')) {
            list.innerHTML = '';
          }
          list.appendChild(newItem);
          
          activityState.currentTimeMinutes = endTime;
          const msg = `Menambah ${name}. Masa tamat ${endTimeStr}.`;
          setInfo(msg); speak(msg);
        };
      });
    }
    
    function formatMinutesToAMPM(totalMinutes) {
      let h = Math.floor(totalMinutes / 60) % 24;
      let m = totalMinutes % 60;
      const ampm = h >= 12 ? 'PM' : 'AM';
      h = h % 12;
      h = h ? h : 12;
      return `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')} ${ampm}`;
    }

    /* ====== Aktiviti 4: Baki Masa Rehat (Permainan) ====== */
    function loadBakiMasa(content) {
      activityState = { bakiMasa: 20 };
      const info = "Permainan Baki Masa: Anda ada 20 minit. Pilih aktiviti dengan bijak!";
      setInfo(info);
      
      content.innerHTML = `
        <h3 class="text-2xl font-bold text-red-600 mb-4">4. Baki Masa Rehat</h3>
        <div class="text-center bg-red-50 p-4 rounded-lg mb-6">
          <div class="text-lg font-semibold text-red-800">Baki Masa Anda:</div>
          <div id="baki-masa-display" class="text-6xl font-black text-red-600 my-2">20</div>
          <div class="text-lg font-semibold text-red-800">minit</div>
        </div>
        <div id="pilihan-aktiviti" class="grid grid-cols-1 md:grid-cols-2 gap-4">
        </div>
        <button onclick="loadActivity(4)" class="mt-6 bg-gray-400 hover:bg-gray-500 text-white font-bold py-2 px-5 rounded-lg">
          Mula Semula
        </button>
      `;
      
      renderPilihanMasa(activityState.bakiMasa);
    }
    
    function renderPilihanMasa(baki) {
      const container = document.getElementById('pilihan-aktiviti');
      const display = document.getElementById('baki-masa-display');
      display.textContent = baki;
      
      const pilihan = [
        { name: "Beli makanan", cost: 7 }, { name: "Bermain bola", cost: 10 },
        { name: "Makan", cost: 10 }, { name: "Borak", cost: 5 }
      ];
      
      container.innerHTML = '';
      
      if (baki === 0) {
        container.innerHTML = `<div class="md:col-span-2 text-center text-xl font-bold text-red-700">Masa rehat telah tamat!</div>`;
        setInfo("Kring! Masa rehat telah tamat."); speak("Kring! Masa rehat telah tamat.");
        return;
      }
      
      pilihan.forEach(p => {
        const isDisabled = baki < p.cost;
        container.innerHTML += `
          <button class="pilihan-btn bg-red-500 hover:bg-red-600 text-white font-semibold p-4 rounded-lg text-lg" 
                  data-cost="${p.cost}" ${isDisabled ? 'disabled' : ''}>
            ${p.name} (Guna ${p.cost} minit)
          </button>
        `;
      });
      
      container.querySelectorAll('button').forEach(btn => {
        btn.onclick = (e) => {
          const cost = parseInt(e.target.dataset.cost);
          activityState.bakiMasa -= cost;
          const msg = `Anda guna ${cost} minit. Baki masa: ${activityState.bakiMasa} minit.`;
          setInfo(msg); speak(msg);
          display.classList.add('shake');
          setTimeout(() => display.classList.remove('shake'), 500);
          renderPilihanMasa(activityState.bakiMasa);
        };
      });
    }

    /* ====== Aktiviti 5: Lumba Minit (Permainan Reaksi) ====== */
    function loadLumbaMinit(content) {
      const targetMinit = 15;
      const info = `Lumba Minit: Sasaran ialah ${targetMinit} minit. Tekan dan tahan butang untuk gerakkan jarum. Lepas pada sasaran!`;
      setInfo(info);
      
      content.innerHTML = `
        <h3 class="text-2xl font-bold text-orange-600 mb-4">5. Lumba Minit</h3>
        <p class="text-lg text-gray-700 mb-4">
          Sasaran: <strong class="text-orange-700">${targetMinit} minit</strong>
        </p>
        <div id="clock-container-5"></div>
        <div id="display-5" class="text-3xl font-bold text-gray-800 mt-2">Minit: 0</div>
        <button id="hold-btn" class="hold-btn mt-4 bg-green-600 hover:bg-green-700 text-white font-bold py-4 px-8 rounded-lg text-xl transition-all duration-100">
          Tekan & Tahan
        </button>
      `;
      
      const clockId = createClockSVG(document.getElementById('clock-container-5'), 0, 0, true);
      const display = document.getElementById('display-5');
      const btn = document.getElementById('hold-btn');
      let gameMinutes = 0;
      
      const updateGameClock = () => {
        gameMinutes = (gameMinutes + 1) % 60;
        updateClockHands(clockId, 0, gameMinutes);
        display.textContent = `Minit: ${gameMinutes}`;
      };
      
      btn.onmousedown = (e) => {
        e.preventDefault(); gameMinutes = 0;
        updateClockHands(clockId, 0, 0);
        display.textContent = `Minit: 0`;
        display.style.color = '#1f2937'; // reset color
        activityTimer = setInterval(updateGameClock, 50); 
        btn.textContent = "Lepaskan!";
      };
      
      btn.onmouseup = (e) => {
        e.preventDefault();
        if (activityTimer) clearInterval(activityTimer);
        btn.textContent = "Tekan & Tahan";
        
        if (gameMinutes === targetMinit) {
          const msg = `Tepat! Anda berhenti di ${gameMinutes} minit. Syabas!`;
          setInfo(msg); speak(msg);
          display.style.color = '#16a34a';
        } else {
          const beza = Math.abs(gameMinutes - targetMinit);
          const msg = `Anda berhenti di ${gameMinutes} minit. Tersasar ${beza} minit. Cuba lagi!`;
          setInfo(msg); speak(msg);
          display.style.color = '#dc2626';
        }
      };
      
      btn.ontouchstart = btn.onmousedown;
      btn.ontouchend = btn.onmouseup;
    }

    /* ====== Kawalan Umum ====== */
    function clearActivity() {
      currentActivity = 0;
      stopClockDrag();
      if (activityTimer) clearInterval(activityTimer);
      
      document.getElementById('activity-content').innerHTML = `
        <div class="text-center py-16">
          <div class="text-6xl mb-4">‚è∞</div>
          <h2 class="text-3xl font-bold text-gray-800 mb-4">Kemahiran Pemulihan: Masa dan Waktu (Intermediate)</h2>
          <p class="text-xl text-gray-600 mb-8">Aplikasikan kemahiran tambah dan tolak masa anda.</p>
          <div class="text-4xl">üëá</div>
        </div>
      `;
      setInfo("Pilih aktiviti 'intermediate' untuk menguji kemahiran masa!");
    }
    
    function nextActivity() {
      if (currentActivity === 0) return loadActivity(1);
      if (currentActivity < 5) return loadActivity(currentActivity + 1);
      return loadActivity(1);
    }

    if ('speechSynthesis' in window) {
      setInterval(() => { if (window.speechSynthesis.paused) window.speechSynthesis.resume(); }, 1000);
    }
  </script>
</body>
</html>
